!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(c,d){return b(a,c,d)}):"object"==typeof exports?module.exports=b(a,require("eventEmitter"),require("eventie")):a.imagesLoaded=b(a,a.EventEmitter,a.eventie)}(this,function(a,b,c){"use strict";function g(a,b){for(var c in b)a[c]=b[c];return a}function i(a){return"[object Array]"===h.call(a)}function j(a){var b=[];if(i(a))b=a;else if("number"==typeof a.length)for(var c=0,d=a.length;d>c;c++)b.push(a[c]);else b.push(a);return b}function k(a,b,c){if(!(this instanceof k))return new k(a,b);"string"==typeof a&&(a=document.querySelectorAll(a)),this.elements=j(a),this.options=g({},this.options),"function"==typeof b?c=b:g(this.options,b),c&&this.on("always",c),this.getImages(),d&&(this.jqDeferred=new d.Deferred);var e=this;setTimeout(function(){e.check()})}function l(a){this.img=a}function n(a){this.src=a,m[a]=this}var d=a.jQuery,e=a.console,f="undefined"!=typeof e,h=Object.prototype.toString;k.prototype=new b,k.prototype.options={},k.prototype.getImages=function(){this.images=[];for(var a=0,b=this.elements.length;b>a;a++){var c=this.elements[a];"IMG"===c.nodeName&&this.addImage(c);var d=c.nodeType;if(d&&(1===d||9===d||11===d))for(var e=c.querySelectorAll("img"),f=0,g=e.length;g>f;f++){var h=e[f];this.addImage(h)}}},k.prototype.addImage=function(a){var b=new l(a);this.images.push(b)},k.prototype.check=function(){function d(d,g){return a.options.debug&&f&&e.log("confirm",d,g),a.progress(d),b++,b===c&&a.complete(),!0}var a=this,b=0,c=this.images.length;if(this.hasAnyBroken=!1,!c)return this.complete(),void 0;for(var g=0;c>g;g++){var h=this.images[g];h.on("confirm",d),h.check()}},k.prototype.progress=function(a){this.hasAnyBroken=this.hasAnyBroken||!a.isLoaded;var b=this;setTimeout(function(){b.emit("progress",b,a),b.jqDeferred&&b.jqDeferred.notify&&b.jqDeferred.notify(b,a)})},k.prototype.complete=function(){var a=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var b=this;setTimeout(function(){if(b.emit(a,b),b.emit("always",b),b.jqDeferred){var c=b.hasAnyBroken?"reject":"resolve";b.jqDeferred[c](b)}})},d&&(d.fn.imagesLoaded=function(a,b){var c=new k(this,a,b);return c.jqDeferred.promise(d(this))}),l.prototype=new b,l.prototype.check=function(){var a=m[this.img.src]||new n(this.img.src);if(a.isConfirmed)return this.confirm(a.isLoaded,"cached was confirmed"),void 0;if(this.img.complete&&void 0!==this.img.naturalWidth)return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0;var b=this;a.on("confirm",function(a,c){return b.confirm(a.isLoaded,c),!0}),a.check()},l.prototype.confirm=function(a,b){this.isLoaded=a,this.emit("confirm",this,b)};var m={};return n.prototype=new b,n.prototype.check=function(){if(!this.isChecked){var a=new Image;c.bind(a,"load",this),c.bind(a,"error",this),a.src=this.src,this.isChecked=!0}},n.prototype.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},n.prototype.onload=function(a){this.confirm(!0,"onload"),this.unbindProxyEvents(a)},n.prototype.onerror=function(a){this.confirm(!1,"onerror"),this.unbindProxyEvents(a)},n.prototype.confirm=function(a,b){this.isConfirmed=!0,this.isLoaded=a,this.emit("confirm",this,b)},n.prototype.unbindProxyEvents=function(a){c.unbind(a.target,"load",this),c.unbind(a.target,"error",this)},k});